<div class="appointments-container">
  <div class="container py-5">
    <!-- Calendar Section -->
    <div class="row">
      <div class="col-md-5 mb-4">
        <mat-card>
          <!-- <mat-card-header>
            <mat-card-title>ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</mat-card-title>
          </mat-card-header> -->
          <mat-card-content>
            <mat-calendar
              [(selected)]="selectedDate"
              [minDate]="minDate"
              [maxDate]="maxDate"
              (selectedChange)="onDateSelected($event)"
              class="arabic-calendar"
            >
            </mat-calendar>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Today's Appointments Section -->
      <div class="col-md-7">
        <div class="section-header">
          <h4 class="section-title">
            @if (isToday(selectedDate)) { Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ… } @else { Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙŠÙˆÙ…
            {{ selectedDate | date : "fullDate" : "" : "ar" }}
            }
          </h4>
          <div class="section-divider"></div>
        </div>

        @if (loading) {
        <div class="text-center text-muted my-5 py-4">
          <div class="spinner-loader">
            <div class="spinner-circle"></div>
            <div class="spinner-text">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯...</div>
          </div>
        </div>
        } @if (error) {
        <div
          class="alert alert-danger alert-elegant text-center animate__animated animate__shakeX"
        >
          {{ error }}
        </div>
        } @if (!loading && appointments.length > 0) {
        <div class="row g-2 justify-content-center appointments-grid">
          @for (appointment of appointments; track appointment.id) {
          <div class="col-sm-4">
            <div
              class="appointment-card appt-card"
              role="button"
              (click)="selected = appointment"
            >
              <div class="card-inner">
                <div class="card-time appt-time">
                   {{ formatTime(appointment.startTime) }} ğŸ•’
                </div>
                <div class="card-patient">
                  ğŸ‘¤ {{ appointment.patientFullName }}
                </div>
                <div class="card-dots">
                  <span></span>
                  <span></span>
                  <span></span>
                </div>
              </div>
            </div>
          </div>
          }
        </div>
        } @else if (!loading && appointments.length === 0) {
        <div
          class="no-appointments text-center animate__animated animate__fadeIn"
        >
          <div class="empty-state">
            <i class="fas fa-calendar-times empty-icon"></i>
            <h5>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</h5>
            <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</p>
          </div>
        </div>
        }
      </div>
    </div>

    @if (selected) {
    <div class="appointment-modal animate__animated animate__fadeIn">
      <div class="modal-content">
        <button class="modal-close" (click)="selected = null" title="details">
          <i class="fas fa-times"></i>
        </button>
        <div class="modal-header">
          <h5>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆØ¹Ø¯</h5>
        </div>
        <div class="modal-body">
          <div class="detail-row">
            <i class="fas fa-user detail-icon"></i>
            <div>
              <span class="detail-label">Ø§Ù„Ø§Ø³Ù…:</span>
              <span class="detail-value">{{ selected.patientName }}</span>
            </div>
          </div>
          <div class="detail-row">
            <i class="fas fa-clock detail-icon"></i>
            <div>
              <span class="detail-label">Ø§Ù„ÙˆÙ‚Øª:</span>
              <span class="detail-value">{{
                formatTime(selected.startTime)
              }}</span>
            </div>
          </div>
          <div class="detail-row">
            <i class="fas fa-stethoscope detail-icon"></i>
            <div>
              <span class="detail-label">Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù„Ø³Ø©:</span>
              <span class="detail-value">{{
                selected.appointmentType == 0 ? "ÙƒØ´Ù" : "Ù…ØªØ§Ø¨Ø¹Ø©"
              }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    }
  </div>
</div>
