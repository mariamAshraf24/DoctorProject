<div class="appointments-container">
  <div class="container py-5">
    <!-- Calendar Section -->
    <div class="row">
      <div class="col-md-5 mb-4">
        <mat-card>
          <!-- <mat-card-header>
            <mat-card-title>تقويم المواعيد</mat-card-title>
          </mat-card-header> -->
          <mat-card-content>
            <mat-calendar
              [(selected)]="selectedDate"
              [minDate]="minDate"
              [maxDate]="maxDate"
              (selectedChange)="onDateSelected($event)"
              class="arabic-calendar"
            >
            </mat-calendar>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Today's Appointments Section -->
      <div class="col-md-7">
        <div class="section-header">
          <h4 class="section-title">
            @if (isToday(selectedDate)) { مواعيد اليوم } @else { مواعيد يوم
            {{ selectedDate | date : "fullDate" : "" : "ar" }}
            }
          </h4>
          <div class="section-divider"></div>
        </div>

        @if (loading) {
        <div class="text-center text-muted my-5 py-4">
          <div class="spinner-loader">
            <div class="spinner-circle"></div>
            <div class="spinner-text">جاري تحميل المواعيد...</div>
          </div>
        </div>
        } @if (error) {
        <div
          class="alert alert-danger alert-elegant text-center animate__animated animate__shakeX"
        >
          {{ error }}
        </div>
        } @if (!loading && appointments.length > 0) {
        <div class="row g-2 justify-content-center appointments-grid">
          @for (appointment of appointments; track appointment.id) {
          <div class="col-sm-4">
            <div
              class="appointment-card appt-card"
              role="button"
              (click)="selected = appointment"
            >
              <div class="card-inner">
                <div class="card-time appt-time">
                   {{ formatTime(appointment.startTime) }} 🕒
                </div>
                <div class="card-patient">
                  👤 {{ appointment.patientFullName }}
                </div>
                <div class="card-dots">
                  <span></span>
                  <span></span>
                  <span></span>
                </div>
              </div>
            </div>
          </div>
          }
        </div>
        } @else if (!loading && appointments.length === 0) {
        <div
          class="no-appointments text-center animate__animated animate__fadeIn"
        >
          <div class="empty-state">
            <i class="fas fa-calendar-times empty-icon"></i>
            <h5>لا توجد مواعيد في هذا اليوم</h5>
            <p>يمكنك إضافة مواعيد جديدة من لوحة التحكم</p>
          </div>
        </div>
        }
      </div>
    </div>

    @if (selected) {
    <div class="appointment-modal animate__animated animate__fadeIn">
      <div class="modal-content">
        <button class="modal-close" (click)="selected = null" title="details">
          <i class="fas fa-times"></i>
        </button>
        <div class="modal-header">
          <h5>تفاصيل الموعد</h5>
        </div>
        <div class="modal-body">
          <div class="detail-row">
            <i class="fas fa-user detail-icon"></i>
            <div>
              <span class="detail-label">الاسم:</span>
              <span class="detail-value">{{ selected.patientName }}</span>
            </div>
          </div>
          <div class="detail-row">
            <i class="fas fa-clock detail-icon"></i>
            <div>
              <span class="detail-label">الوقت:</span>
              <span class="detail-value">{{
                formatTime(selected.startTime)
              }}</span>
            </div>
          </div>
          <div class="detail-row">
            <i class="fas fa-stethoscope detail-icon"></i>
            <div>
              <span class="detail-label">نوع الجلسة:</span>
              <span class="detail-value">{{
                selected.appointmentType == 0 ? "كشف" : "متابعة"
              }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    }
  </div>
</div>
